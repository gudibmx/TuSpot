<!doctype html>
<html lang="es">
<head>
  <meta name="google-site-verification" content="GHiNh5ZRGsV9W1miRuMfl1MS-Egpv1VTgVbEBTU72sI" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spots</title>
  <style>
    :root {
      --bg: #f5f5f5;
      --card: #ffffff;
      --text: #1a1a1a;
      --accent: #000000;
      --muted: #666666;
      --border: #e5e5e5;
    }
    body.dark {
      --bg: #121212;
      --card: #1e1e1e;
      --text: #f5f5f5;
      --accent: #ffffff;
      --muted: #aaaaaa;
      --border: #333333;
    }
    * {
      box-sizing: border-box;
      font-family: 'Inter', Arial, sans-serif;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      padding: 16px;
      transition: background 0.3s, color 0.3s;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
      position: relative;
    }
    h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 700;
    }
    #themeToggle {
      position: absolute;
      right: 0;
      top: 0;
      background: var(--accent);
      color: var(--bg);
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
    }
    form {
      background: var(--card);
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: background 0.3s;
    }
    label {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 6px;
      display: block;
    }
    input[type=text], input[type=file] {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #fafafa;
      color: var(--text);
      margin-bottom: 12px;
    }
    button {
      background: var(--accent);
      color: var(--bg);
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 6px;
    }
    .spots-list {
      margin-top: 20px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    .spot {
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: background 0.3s;
    }
    .spot img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .spot-info {
      padding: 12px;
    }
    .spot-info h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 700;
    }
    .spot-info p {
      margin: 4px 0 0;
      font-size: 14px;
      color: var(--muted);
    }
    .delete-btn {
      margin-top: 8px;
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 10px;
      width: 100%;
      font-size: 14px;
    }
    .empty {
      text-align: center;
      color: var(--muted);
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Spots</h1>
      <button id="themeToggle">üåô</button>
    </header>

    <form id="spotForm">
      <label for="name">Nombre del spot</label>
      <input id="name" type="text" required placeholder="Ej: Escal√≥n del centro">

      <label for="location">Ubicaci√≥n (texto)</label>
      <input id="location" type="text" required placeholder="Ej: Barrio G√ºemes, C√≥rdoba">

      <label>Foto</label>
      <button type="button" id="takePhotoBtn">üì∏ Tomar foto</button>
      <input id="photoInput" type="file" accept="image/*" style="display:none">
      <button type="button" id="uploadPhotoBtn">üìÇ Subir foto existente</button>

      <button type="submit">Agregar spot</button>
    </form>

    <div id="spots" class="spots-list"></div>
    <div id="empty" class="empty">No hay spots todav√≠a.</div>
  </div>

  <script>
  const BIN_URL = "https://api.jsonbin.io/v3/b/68eedd0043b1c97be968527d"; // tu URL del bin
  const MASTER_KEY = "$2a$10$BAfVrcITcswjDJHUDvyXgOcKEpAVwOxbnhso2jpxCw4Gp0xRRUzOy"; // tu clave de jsonbin.io

  const form = document.getElementById('spotForm');
  const spotsEl = document.getElementById('spots');
  const emptyEl = document.getElementById('empty');
  const takePhotoBtn = document.getElementById('takePhotoBtn');
  const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
  const photoInput = document.getElementById('photoInput');
  const themeToggle = document.getElementById('themeToggle');

  let selectedFile = null;
  let spots = [];

  async function fetchSpots() {
    try {
      const res = await fetch(BIN_URL, {
        headers: { "X-Master-Key": MASTER_KEY }
      });
      const data = await res.json();
      spots = data.record.spots || [];
      renderSpots();
    } catch (err) {
      console.error(err);
      alert("Error al cargar los spots");
    }
  }

  async function saveSpots() {
    try {
      await fetch(BIN_URL, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": MASTER_KEY
        },
        body: JSON.stringify({ spots })
      });
    } catch (err) {
      console.error(err);
      alert("Error al guardar");
    }
  }

  function renderSpots() {
    spotsEl.innerHTML = '';
    if (!spots.length) {
      emptyEl.style.display = 'block';
      return;
    }
    emptyEl.style.display = 'none';
    spots.slice().reverse().forEach((spot, idx) => {
      const div = document.createElement('div');
      div.className = 'spot';
      div.innerHTML = `
        <img src="${spot.photo}" alt="${spot.name}">
        <div class="spot-info">
          <h3>${spot.name}</h3>
          <p>${spot.location}</p>
          <button class="delete-btn" data-index="${spots.length - 1 - idx}">Eliminar</button>
        </div>
      `;
      spotsEl.appendChild(div);
    });

    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        const i = e.target.dataset.index;
        spots.splice(i, 1);
        saveSpots();
        renderSpots();
      });
    });
  }

  function resizeImage(file, maxWidth = 600, quality = 0.8) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = e => {
        const img = new Image();
        img.onload = () => {
          const scale = Math.min(1, maxWidth / img.width);
          const canvas = document.createElement('canvas');
          canvas.width = img.width * scale;
          canvas.height = img.height * scale;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          resolve(canvas.toDataURL('image/jpeg', quality));
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    });
  }

  takePhotoBtn.addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.capture = 'environment';
    input.onchange = e => { selectedFile = e.target.files[0]; };
    input.click();
  });

  uploadPhotoBtn.addEventListener('click', () => photoInput.click());
  photoInput.addEventListener('change', e => selectedFile = e.target.files[0]);

  form.addEventListener('submit', async e => {
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const location = document.getElementById('location').value.trim();
    if (!name || !location || !selectedFile) return alert('Completa todos los campos y agrega una foto');
    const photo = await resizeImage(selectedFile);
    spots.push({ name, location, photo });
    await saveSpots();
    form.reset();
    selectedFile = null;
    renderSpots();
  });

  themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    themeToggle.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
  });

  // Cargar al iniciar
  fetchSpots();
  </script>
</body>
</html>
